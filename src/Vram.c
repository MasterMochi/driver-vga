/******************************************************************************/
/* src/Vram.c                                                                 */
/*                                                                 2018/09/04 */
/* Copyright (C) 2018 Mochi.                                                  */
/******************************************************************************/
/******************************************************************************/
/* インクルード                                                               */
/******************************************************************************/
/* 共通ヘッダ */
#include <stdint.h>
#include <kernel/library.h>


/******************************************************************************/
/* グローバル変数定義                                                         */
/******************************************************************************/
/** VRAM */
static uint8_t *pgVram = NULL;


/******************************************************************************/
/* グローバル関数定義                                                         */
/******************************************************************************/
/******************************************************************************/
/**
 * @brief       VRAM初期化
 * @detail      VRAM領域を割り当てる。
 */
/******************************************************************************/
void VramInit( void )
{
    uint32_t errNo; /* エラー番号 */
    
    /* 初期化 */
    errNo = MK_MSG_ERR_NONE;
    
    /* VRAM領域割当 */
    pgVram = MkIoMemAlloc( ( void * ) 0x000B8000, 0x00008000, &errNo );
    
    /* 割当結果判定 */
    if ( pgVram == NULL ) {
        /* 失敗 */
        
        /* [TODO]アボート */
    }
    
    return;
}


/******************************************************************************/
/**
 * @brief       VRAM書込み
 * @details     指定した行列に対応するVRAM領域に文字と属性を書き込む。
 * 
 * @param[in]   row    行(1オリジン)
 * @param[in]   column 列(1オリジン)
 * @param[in]   c      文字
 * @param[in]   attr   属性
 */
/******************************************************************************/
void VramWrite( uint32_t row,
                uint32_t column,
                uint8_t  c,
                uint8_t  attr    )
{
    /* オリジン変換 */
    row    -= 1;
    column -= 1;
    
    /* 書込み */
    pgVram[ row * 80 * 2 + column * 2     ] = c;
    pgVram[ row * 80 * 2 + column * 2 + 1 ] = attr;
    
    return;
}


/******************************************************************************/
